From bbd2ea14f000e441ad1c5e7ecea250339a5f32a5 Mon Sep 17 00:00:00 2001
From: Lovely_xianxian <xyx_dada@outlook.com>
Date: Tue, 7 Apr 2020 12:10:41 +0800
Subject: [PATCH] Only bedrock and piston head are allowed to be set to air

---
 src/main/java/net/minecraft/server/BlockPiston.java | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/src/main/java/net/minecraft/server/BlockPiston.java b/src/main/java/net/minecraft/server/BlockPiston.java
index b29525c40..2ed95b2a4 100644
--- a/src/main/java/net/minecraft/server/BlockPiston.java
+++ b/src/main/java/net/minecraft/server/BlockPiston.java
@@ -232,7 +232,13 @@ public class BlockPiston extends BlockDirectional {
                     }
                 }
             } else {
-                world.a(blockposition.shift(enumdirection), false);
+                // Nebula start - Only bedrock and piston head are allowed to be set to air
+                BlockPosition headPosition = blockposition.shift(enumdirection);
+                IBlockData headData = world.getType(headPosition);
+                Block headBlock = headData.getBlock();
+                if (headBlock == Blocks.BEDROCK || headBlock == Blocks.PISTON_HEAD)
+                // Nebula end
+                world.a(headPosition, false);
             }
 
             world.playSound((EntityHuman) null, blockposition, SoundEffects.BLOCK_PISTON_CONTRACT, SoundCategory.BLOCKS, 0.5F, world.random.nextFloat() * 0.15F + 0.6F);
-- 
2.25.0

