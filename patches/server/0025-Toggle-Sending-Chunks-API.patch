From 07039498627f5c9d225547dfed64d2bdc11192d5 Mon Sep 17 00:00:00 2001
From: Lovely_xianxian <xyx_dada@outlook.com>
Date: Sat, 25 Apr 2020 20:05:29 +0800
Subject: [PATCH] Toggle Sending Chunks API

---
 src/main/java/net/minecraft/server/Chunk.java       |  1 +
 .../org/bukkit/craftbukkit/entity/CraftPlayer.java  | 13 +++++++++++++
 2 files changed, 14 insertions(+)

diff --git a/src/main/java/net/minecraft/server/Chunk.java b/src/main/java/net/minecraft/server/Chunk.java
index f6c5b7075..45763a4fc 100644
--- a/src/main/java/net/minecraft/server/Chunk.java
+++ b/src/main/java/net/minecraft/server/Chunk.java
@@ -284,6 +284,7 @@ public class Chunk implements IChunkAccess {
                             continue;
                         }
                         EntityPlayer player = (EntityPlayer)temp;
+                        if (player.getBukkitEntity().needSendChunks()) // Nebula - Toggle Chunk Sending API
                         chunkMap.sendChunk(player, chunkPackets, Chunk.this);
                     }
                 })));
diff --git a/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java b/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
index 747fb04a0..e096e17b6 100644
--- a/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
+++ b/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
@@ -2081,4 +2081,17 @@ public class CraftPlayer extends CraftHumanEntity implements Player {
         return spigot;
     }
     // Spigot end
+
+    // Nebula start - Toggle sending chunks API
+    private boolean needSendChunks = true;
+    @Override
+    public void setSendChunks(boolean sendChunks) {
+        this.needSendChunks = true;
+    }
+
+    @Override
+    public boolean needSendChunks() {
+        return needSendChunks;
+    }
+    // Nebula end
 }
-- 
2.26.2

