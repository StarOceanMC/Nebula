From 3fa487195d0e3b05714844025828e9bd15ba32b7 Mon Sep 17 00:00:00 2001
From: Lovely_xianxian <xyx_dada@outlook.com>
Date: Sat, 25 Apr 2020 20:05:29 +0800
Subject: [PATCH] Toggle Sending Chunks API

---
 src/main/java/net/minecraft/server/Chunk.java       |  1 +
 .../org/bukkit/craftbukkit/entity/CraftPlayer.java  | 13 +++++++++++++
 2 files changed, 14 insertions(+)

diff --git a/src/main/java/net/minecraft/server/Chunk.java b/src/main/java/net/minecraft/server/Chunk.java
index f1a382c3d..fa03a18f5 100644
--- a/src/main/java/net/minecraft/server/Chunk.java
+++ b/src/main/java/net/minecraft/server/Chunk.java
@@ -287,6 +287,7 @@ public class Chunk implements IChunkAccess {
                             continue;
                         }
                         EntityPlayer player = (EntityPlayer)temp;
+                        if (player.getBukkitEntity().needSendChunks()) // Nebula - Toggle Chunk Sending API
                         chunkMap.sendChunk(player, chunkPackets, Chunk.this);
                     }
                 })));
diff --git a/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java b/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
index ad7860179..adf5745fe 100644
--- a/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
+++ b/src/main/java/org/bukkit/craftbukkit/entity/CraftPlayer.java
@@ -2156,4 +2156,17 @@ public class CraftPlayer extends CraftHumanEntity implements Player {
         return spigot;
     }
     // Spigot end
+
+    // Nebula start - Toggle sending chunks API
+    private boolean needSendChunks = true;
+    @Override
+    public void setSendChunks(boolean sendChunks) {
+        this.needSendChunks = true;
+    }
+
+    @Override
+    public boolean needSendChunks() {
+        return needSendChunks;
+    }
+    // Nebula end
 }
-- 
2.28.0

