From d6031745bcd6fdda05dc6f9a3b0460b06f9b8f11 Mon Sep 17 00:00:00 2001
From: Lovely_xianxian <xyx_dada@outlook.com>
Date: Sun, 5 Jan 2020 15:01:48 +0800
Subject: [PATCH] Add EventPriority.NEVER for customizing priority

---
 src/main/java/org/bukkit/event/EventPriority.java          | 6 ++++++
 src/main/java/org/bukkit/plugin/SimplePluginManager.java   | 2 ++
 src/main/java/org/bukkit/plugin/java/JavaPluginLoader.java | 4 +++-
 3 files changed, 11 insertions(+), 1 deletion(-)

diff --git a/src/main/java/org/bukkit/event/EventPriority.java b/src/main/java/org/bukkit/event/EventPriority.java
index 61ffa50f..f368ad0c 100644
--- a/src/main/java/org/bukkit/event/EventPriority.java
+++ b/src/main/java/org/bukkit/event/EventPriority.java
@@ -5,6 +5,12 @@ package org.bukkit.event;
  */
 public enum EventPriority {
 
+	// Nebula start - Add EventPriority.NEVER for customizing priority
+	/**
+	 * Event will be never called
+	 */
+	NEVER(-100),
+	// Nebula end
     /**
      * Event call is of very low importance and should be ran first, to allow
      * other plugins to further customise the outcome
diff --git a/src/main/java/org/bukkit/plugin/SimplePluginManager.java b/src/main/java/org/bukkit/plugin/SimplePluginManager.java
index cbf3b5da..41b0c411 100644
--- a/src/main/java/org/bukkit/plugin/SimplePluginManager.java
+++ b/src/main/java/org/bukkit/plugin/SimplePluginManager.java
@@ -681,8 +681,10 @@ public final class SimplePluginManager implements PluginManager {
         
         executor = new co.aikar.timings.TimedEventExecutor(executor, plugin, null, event); // Paper
         if (false) { // Spigot - RL handles useTimings check now // Paper
+        	if (customedPriority != org.bukkit.event.EventPriority.NEVER) // Nebula - Add EventPriority.NEVER for customizing priority
             getEventListeners(event).register(new TimedRegisteredListener(listener, executor, customedPriority, plugin, ignoreCancelled)); //Nebula - Configurable EventPriority
         } else {
+        	if (customedPriority != org.bukkit.event.EventPriority.NEVER) // Nebula - Add EventPriority.NEVER for customizing priority
             getEventListeners(event).register(new RegisteredListener(listener, executor, customedPriority, plugin, ignoreCancelled)); //Nebula - Configurable EventPriority
         }
     }
diff --git a/src/main/java/org/bukkit/plugin/java/JavaPluginLoader.java b/src/main/java/org/bukkit/plugin/java/JavaPluginLoader.java
index d0da8617..f6760cc0 100644
--- a/src/main/java/org/bukkit/plugin/java/JavaPluginLoader.java
+++ b/src/main/java/org/bukkit/plugin/java/JavaPluginLoader.java
@@ -338,9 +338,11 @@ public final class JavaPluginLoader implements PluginLoader {
             
             EventExecutor executor = new co.aikar.timings.TimedEventExecutor(EventExecutor.create(method, eventClass), plugin, method, eventClass); // Paper // Paper (Yes.) - Use factory method `EventExecutor.create()`
             if (false) { // Spigot - RL handles useTimings check now
+            	if (priority != org.bukkit.event.EventPriority.NEVER) // Nebula - Add EventPriority.NEVER for customizing priority
                 eventSet.add(new TimedRegisteredListener(listener, executor, priority, plugin, eh.ignoreCancelled())); //Nebula - Configurable EventPriority
             } else {
-                eventSet.add(new RegisteredListener(listener, executor, priority, plugin, eh.ignoreCancelled())); //Nebula - Configurable EventPriority
+            	if (priority != org.bukkit.event.EventPriority.NEVER) // Nebula - Add EventPriority.NEVER for customizing priority
+            	eventSet.add(new RegisteredListener(listener, executor, priority, plugin, eh.ignoreCancelled())); //Nebula - Configurable EventPriority
             }
         }
         return ret;
-- 
2.25.0

